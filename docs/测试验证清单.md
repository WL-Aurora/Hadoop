# 虚拟机远程连接功能测试验证清单

## 测试环境准备

### 虚拟机环境

- [ ] 准备 3 台 CentOS 7 虚拟机
- [ ] 配置静态 IP 地址（例如：192.168.10.101、192.168.10.102、192.168.10.103）
- [ ] 启动 SSH 服务（sshd）
- [ ] 创建测试用户账号（例如：root 或 hadoop）
- [ ] 确保宿主机与虚拟机网络互通

### 应用程序环境

- [ ] 安装 JDK 1.8+
- [ ] 安装 JavaFX 17+
- [ ] 编译项目：`mvn clean compile`
- [ ] 打包项目：`mvn package`

---

## 9.1 测试完整连接流程

### 测试场景 1：正常连接（3 台虚拟机全部成功）

**前置条件：**

- 3 台虚拟机已启动
- SSH 服务正常运行
- 网络连接正常

**测试步骤：**

1. 启动应用程序
2. 输入 3 台虚拟机的 IP 地址
3. 输入正确的用户名和密码
4. 点击"测试连接"按钮

**预期结果：**

- [ ] 测试按钮变为禁用状态
- [ ] 显示加载动画
- [ ] 3 个状态标签显示"测试中..."（蓝色）
- [ ] 测试完成后，3 个状态标签显示"✓ 连接成功"（绿色）
- [ ] 没有错误提示信息
- [ ] "下一步"按钮变为启用状态
- [ ] 弹出成功提示对话框
- [ ] 配置自动保存到 ~/.hads/config.json
- [ ] 测试按钮恢复为启用状态
- [ ] 加载动画隐藏

**验证点：**

- [ ] 响应时间 ≤ 30 秒
- [ ] 日志文件记录连接测试过程
- [ ] SSH 会话已建立并缓存

---

### 测试场景 2：网络异常（IP 不可达）

**前置条件：**

- 输入一个不存在的 IP 地址（例如：192.168.10.200）

**测试步骤：**

1. 在虚拟机 1 的 IP 输入框输入不存在的 IP
2. 输入用户名和密码
3. 点击"测试连接"按钮

**预期结果：**

- [ ] 虚拟机 1 状态标签显示"✗ 网络不可达"（红色）
- [ ] 虚拟机 1 错误提示显示"网络不通，请检查 IP 地址和网络配置"
- [ ] 其他虚拟机正常测试
- [ ] "下一步"按钮保持禁用状态
- [ ] 弹出警告对话框提示部分虚拟机连接失败

**验证点：**

- [ ] 错误信息清晰明确
- [ ] 不影响其他虚拟机的测试
- [ ] 日志记录网络不可达错误

---

### 测试场景 3：SSH 服务异常（端口未开放）

**前置条件：**

- 在一台虚拟机上停止 SSH 服务：`systemctl stop sshd`

**测试步骤：**

1. 输入该虚拟机的 IP 地址
2. 输入用户名和密码
3. 点击"测试连接"按钮

**预期结果：**

- [ ] 该虚拟机状态标签显示"✗ SSH 服务未启动"（红色）
- [ ] 错误提示显示"SSH 服务未启动，请在虚拟机中启动 sshd 服务"
- [ ] "下一步"按钮保持禁用状态

**验证点：**

- [ ] 能够区分网络不通和 SSH 服务未启动
- [ ] 错误诊断准确
- [ ] 日志记录 SSH 服务异常

---

### 测试场景 4：认证失败（错误的用户名或密码）

**前置条件：**

- 虚拟机正常运行
- SSH 服务正常

**测试步骤：**

1. 输入正确的 IP 地址
2. 输入错误的用户名或密码
3. 点击"测试连接"按钮

**预期结果：**

- [ ] 状态标签显示"✗ 认证失败"（红色）
- [ ] 错误提示显示"用户名或密码错误，请检查登录凭证"
- [ ] "下一步"按钮保持禁用状态

**验证点：**

- [ ] 能够识别认证失败
- [ ] 密码在日志中脱敏显示（显示为 \*\*\*）
- [ ] 不会泄露敏感信息

---

### 测试场景 5：连接超时

**前置条件：**

- 配置防火墙规则延迟 SSH 响应，或使用网络模拟工具

**测试步骤：**

1. 输入会导致超时的 IP 地址
2. 输入用户名和密码
3. 点击"测试连接"按钮

**预期结果：**

- [ ] 等待约 30 秒后显示超时错误
- [ ] 状态标签显示"✗ 连接超时"（红色）
- [ ] 错误提示显示"连接超时，请检查网络状态和防火墙设置"
- [ ] "下一步"按钮保持禁用状态

**验证点：**

- [ ] 超时时间设置为 30 秒
- [ ] 超时后不会阻塞界面
- [ ] 日志记录超时错误

---

## 9.2 测试配置持久化

### 测试场景 1：保存配置功能

**测试步骤：**

1. 输入 3 台虚拟机的连接信息
2. 测试连接成功
3. 检查配置文件 ~/.hads/config.json

**预期结果：**

- [ ] 配置文件已创建
- [ ] 配置文件包含 3 台虚拟机的信息
- [ ] IP 地址、用户名正确保存
- [ ] 密码已加密存储（不是明文）
- [ ] 包含版本号和最后修改时间

**验证点：**

- [ ] 配置文件格式为 JSON
- [ ] 配置文件可读性良好（格式化输出）
- [ ] 密码加密算法为 AES-256

---

### 测试场景 2：加载配置功能

**测试步骤：**

1. 关闭应用程序
2. 重新启动应用程序
3. 检查界面输入框

**预期结果：**

- [ ] 3 个 IP 输入框自动填充保存的 IP 地址
- [ ] 用户名输入框自动填充保存的用户名
- [ ] 密码输入框自动填充保存的密码
- [ ] 无错误提示

**验证点：**

- [ ] 密码正确解密
- [ ] 界面显示正常
- [ ] 日志记录配置加载过程

---

### 测试场景 3：配置文件损坏处理

**测试步骤：**

1. 手动修改 ~/.hads/config.json，破坏 JSON 格式
2. 启动应用程序

**预期结果：**

- [ ] 应用程序正常启动
- [ ] 弹出警告对话框提示配置加载失败
- [ ] 界面显示空配置（默认配置）
- [ ] 不会崩溃

**验证点：**

- [ ] 异常处理正确
- [ ] 日志记录配置损坏错误
- [ ] 用户体验良好

---

### 测试场景 4：配置文件不存在

**测试步骤：**

1. 删除 ~/.hads/config.json
2. 启动应用程序

**预期结果：**

- [ ] 应用程序正常启动
- [ ] 界面显示空配置
- [ ] 无错误提示

**验证点：**

- [ ] 首次启动体验良好
- [ ] 日志记录配置文件不存在

---

## 9.3 测试界面交互

### 测试场景 1：IP 地址实时验证

**测试步骤：**

1. 在 IP 输入框中输入无效的 IP 地址（例如：999.999.999.999）
2. 观察界面反馈

**预期结果：**

- [ ] 输入框边框变为红色
- [ ] 下方显示错误提示"IP 地址格式不正确，请输入有效的 IPv4 地址"
- [ ] 错误提示为红色斜体文字

**测试步骤 2：**

1. 修正 IP 地址为有效格式（例如：192.168.10.101）
2. 观察界面反馈

**预期结果：**

- [ ] 输入框边框恢复正常（蓝色或灰色）
- [ ] 错误提示消失

**验证点：**

- [ ] 实时验证响应迅速（无延迟）
- [ ] 验证规则正确（IPv4 格式）
- [ ] 用户体验良好

---

### 测试场景 2：密码显示切换

**测试步骤：**

1. 在密码输入框输入密码
2. 点击"显示"按钮
3. 观察密码显示
4. 再次点击按钮（现在显示为"隐藏"）

**预期结果：**

- [ ] 点击"显示"后，密码以明文显示
- [ ] 按钮文本变为"隐藏"
- [ ] 点击"隐藏"后，密码变为密文（圆点）
- [ ] 按钮文本变为"显示"
- [ ] 密码内容不丢失

**验证点：**

- [ ] 切换流畅无卡顿
- [ ] 密码内容保持一致

---

### 测试场景 3：按钮状态切换

**测试步骤：**

1. 启动应用程序
2. 观察"下一步"按钮状态
3. 测试连接成功后观察按钮状态

**预期结果：**

- [ ] 初始状态"下一步"按钮为禁用（灰色）
- [ ] 测试连接过程中"测试连接"按钮禁用
- [ ] 测试成功后"下一步"按钮启用（蓝色）
- [ ] 测试失败后"下一步"按钮保持禁用

**验证点：**

- [ ] 按钮状态逻辑正确
- [ ] 视觉反馈清晰

---

### 测试场景 4：加载动画显示

**测试步骤：**

1. 点击"测试连接"按钮
2. 观察加载动画

**预期结果：**

- [ ] 加载动画立即显示
- [ ] 动画旋转流畅
- [ ] 测试完成后动画消失

**验证点：**

- [ ] 动画位置合理
- [ ] 动画大小适中

---

### 测试场景 5：操作响应时间

**测试步骤：**

1. 测量各种操作的响应时间

**预期结果：**

- [ ] IP 输入验证响应时间 < 100ms
- [ ] 密码显示切换响应时间 < 100ms
- [ ] 按钮点击响应时间 < 100ms
- [ ] 连接测试总时间 ≤ 30 秒（正常情况）

**验证点：**

- [ ] 界面流畅不卡顿
- [ ] 用户体验良好

---

## 9.4 性能优化

### 测试场景 1：异步执行验证

**测试步骤：**

1. 点击"测试连接"按钮
2. 在测试过程中尝试移动窗口、点击其他按钮

**预期结果：**

- [ ] 窗口可以正常移动
- [ ] 界面不会冻结
- [ ] 其他界面元素可以正常交互（除了被禁用的按钮）

**验证点：**

- [ ] 使用 JavaFX Task 在后台线程执行
- [ ] UI 线程不被阻塞

---

### 测试场景 2：并行测试验证

**测试步骤：**

1. 查看日志文件
2. 观察 3 台虚拟机的测试时间戳

**预期结果：**

- [ ] 3 台虚拟机的测试几乎同时开始
- [ ] 总测试时间接近单台虚拟机的测试时间（而不是 3 倍）

**验证点：**

- [ ] 使用并行测试而非串行
- [ ] 性能优化有效

---

### 测试场景 3：SSH 会话缓存验证

**测试步骤：**

1. 测试连接成功
2. 查看日志，确认会话已缓存
3. 后续操作（如果有）应复用会话

**预期结果：**

- [ ] 日志显示"SSH 会话创建成功"
- [ ] 日志显示会话已缓存
- [ ] 后续操作使用缓存的会话（日志显示"使用缓存的 SSH 会话"）

**验证点：**

- [ ] 会话缓存机制正常工作
- [ ] 避免重复建立连接

---

### 测试场景 4：超时时间验证

**测试步骤：**

1. 查看代码或配置
2. 确认超时时间设置

**预期结果：**

- [ ] SSH 连接超时时间设置为 30 秒
- [ ] 网络可达性检测超时时间设置为 5 秒
- [ ] 端口检测超时时间设置为 5 秒

**验证点：**

- [ ] 超时时间配置合理
- [ ] 不会无限等待

---

## 9.5 安全性验证

### 测试场景 1：密码加密存储验证

**测试步骤：**

1. 测试连接成功，保存配置
2. 打开 ~/.hads/config.json
3. 查看密码字段

**预期结果：**

- [ ] 密码字段不是明文
- [ ] 密码字段是加密后的字符串（Base64 编码）
- [ ] 无法直接识别原始密码

**验证点：**

- [ ] 使用 AES-256 加密算法
- [ ] 加密密钥安全存储在 ~/.hads/keys/

---

### 测试场景 2：日志密码脱敏验证

**测试步骤：**

1. 执行连接测试
2. 打开日志文件 ~/.hads/logs/
3. 搜索密码相关内容

**预期结果：**

- [ ] 日志中不包含明文密码
- [ ] 密码显示为 \*\*\* 或类似脱敏标记
- [ ] VMConnectionConfig 的 toString 方法正确脱敏

**验证点：**

- [ ] 所有日志输出都进行密码脱敏
- [ ] 不会泄露敏感信息

---

### 测试场景 3：内存中密码处理验证

**测试步骤：**

1. 查看代码实现
2. 确认密码在内存中的处理方式

**预期结果：**

- [ ] 密码使用 String 类型存储（Java 8 环境）
- [ ] 密码在不需要时及时清除引用
- [ ] 配置对象在使用完毕后正确释放

**验证点：**

- [ ] 密码处理符合安全最佳实践
- [ ] 最小化密码在内存中的存在时间

---

### 测试场景 4：应用退出时清理验证

**测试步骤：**

1. 建立 SSH 连接
2. 关闭应用程序
3. 查看日志

**预期结果：**

- [ ] 日志显示"开始清理资源"
- [ ] 日志显示"SSH 会话已关闭"（每台虚拟机）
- [ ] 日志显示"所有 SSH 会话已关闭"
- [ ] 日志显示"资源清理完成"

**验证点：**

- [ ] Main.stop() 方法正确调用
- [ ] ConnectionController.cleanup() 方法正确执行
- [ ] 所有 SSH 会话正确关闭
- [ ] 不会泄露系统资源

---

## 测试总结

### 测试统计

- 总测试场景数：20
- 通过场景数：\_\_\_
- 失败场景数：\_\_\_
- 阻塞场景数：\_\_\_

### 发现的问题

1.
2.
3.

### 优化建议

1.
2.
3.

### 测试结论

- [ ] 所有核心功能正常工作
- [ ] 所有需求已满足
- [ ] 性能符合预期
- [ ] 安全性符合要求
- [ ] 可以进入下一阶段开发

---

**测试人员：** ****\_\_\_****  
**测试日期：** ****\_\_\_****  
**测试版本：** 1.0.0
