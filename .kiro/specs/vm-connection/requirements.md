# 需求文档

## 简介

虚拟机远程连接功能是Hadoop自动化部署系统的基础模块，负责建立宿主机与3台CentOS虚拟机之间的SSH连接。该功能通过JavaFX图形界面收集虚拟机连接信息（IP地址、用户名、密码），验证连接可用性，并为后续的集群部署操作提供稳定的远程执行通道。

## 术语表

- **HADS系统**：Hadoop自动化部署系统（Hadoop Auto Deployment System）
- **虚拟机节点**：运行CentOS 7操作系统的VMware虚拟机实例
- **SSH连接**：基于SSH协议的安全远程连接
- **连接配置**：包含IP地址、用户名、密码的虚拟机访问凭证
- **连接测试**：验证SSH连接可用性的操作
- **JSch库**：Java实现的SSH2协议客户端库

## 需求

### 需求1：虚拟机连接信息输入

**用户故事：** 作为系统用户，我希望能够在图形界面中输入3台虚拟机的连接信息，以便系统能够远程连接到这些虚拟机。

#### 验收标准

1. WHEN用户打开连接配置界面，THE HADS系统 SHALL 显示3个虚拟机的IP地址输入框
2. WHEN用户在IP地址输入框中输入内容，THE HADS系统 SHALL 实时验证IP地址格式的合法性
3. THE HADS系统 SHALL 提供统一的用户名输入框用于配置3台虚拟机的登录用户名
4. THE HADS系统 SHALL 提供统一的密码输入框用于配置3台虚拟机的登录密码
5. WHEN用户点击密码显示切换按钮，THE HADS系统 SHALL 在明文和密文之间切换密码显示状态

### 需求2：IP地址格式验证

**用户故事：** 作为系统用户，我希望系统能够验证我输入的IP地址格式是否正确，以便避免因格式错误导致连接失败。

#### 验收标准

1. WHEN用户输入的IP地址不符合IPv4格式，THE HADS系统 SHALL 在输入框旁显示错误提示信息
2. WHEN用户输入的IP地址符合IPv4格式，THE HADS系统 SHALL 清除错误提示信息
3. IF用户输入的IP地址为空，THEN THE HADS系统 SHALL 显示"IP地址不能为空"的提示信息
4. THE HADS系统 SHALL 验证IP地址的每个段在0到255之间

### 需求3：SSH连接测试

**用户故事：** 作为系统用户，我希望在开始部署前能够测试虚拟机连接是否正常，以便及时发现和解决连接问题。

#### 验收标准

1. WHEN用户点击"测试连接"按钮，THE HADS系统 SHALL 依次尝试连接3台虚拟机
2. WHILE连接测试正在执行，THE HADS系统 SHALL 显示加载动画并禁用"测试连接"按钮
3. WHEN某台虚拟机连接成功，THE HADS系统 SHALL 在该虚拟机对应位置显示"连接成功"状态标识
4. WHEN某台虚拟机连接失败，THE HADS系统 SHALL 在该虚拟机对应位置显示"连接失败"状态标识和失败原因
5. WHEN所有虚拟机连接测试完成，THE HADS系统 SHALL 启用"下一步"按钮（仅当所有连接成功时）

### 需求4：连接失败诊断

**用户故事：** 作为系统用户，当虚拟机连接失败时，我希望系统能够提供明确的失败原因，以便我能够快速定位和解决问题。

#### 验收标准

1. IF虚拟机网络不可达，THEN THE HADS系统 SHALL 显示"网络不通，请检查IP地址和网络配置"的提示信息
2. IF SSH服务未启动，THEN THE HADS系统 SHALL 显示"SSH服务未启动，请在虚拟机中启动sshd服务"的提示信息
3. IF用户名或密码错误，THEN THE HADS系统 SHALL 显示"用户名或密码错误，请检查登录凭证"的提示信息
4. IF连接超时，THEN THE HADS系统 SHALL 显示"连接超时，请检查网络状态和防火墙设置"的提示信息
5. THE HADS系统 SHALL 在失败提示中包含具体的虚拟机标识（如"虚拟机1（192.168.10.101）"）

### 需求5：连接配置持久化

**用户故事：** 作为系统用户，我希望系统能够保存我输入的连接配置，以便下次使用时不需要重新输入。

#### 验收标准

1. WHEN用户完成连接配置并测试成功，THE HADS系统 SHALL 将连接配置保存到本地配置文件
2. WHEN用户再次打开连接配置界面，THE HADS系统 SHALL 自动加载上次保存的连接配置
3. THE HADS系统 SHALL 将密码加密后存储在配置文件中
4. THE HADS系统 SHALL 将配置文件保存在用户目录的.hads/config.json路径下
5. IF配置文件不存在或损坏，THEN THE HADS系统 SHALL 使用默认空配置并提示用户

### 需求6：SSH会话管理

**用户故事：** 作为系统开发者，我需要系统能够有效管理SSH连接会话，以便为后续的远程操作提供稳定的连接通道。

#### 验收标准

1. WHEN连接测试成功，THE HADS系统 SHALL 创建并保持SSH会话对象
2. THE HADS系统 SHALL 为每台虚拟机维护独立的SSH会话
3. WHEN用户关闭应用程序，THE HADS系统 SHALL 正确关闭所有SSH会话并释放资源
4. IF SSH会话在使用过程中断开，THEN THE HADS系统 SHALL 尝试自动重连（最多3次）
5. THE HADS系统 SHALL 设置SSH连接超时时间为30秒

### 需求7：界面交互反馈

**用户故事：** 作为系统用户，我希望在操作过程中能够获得清晰的界面反馈，以便了解当前操作的状态和结果。

#### 验收标准

1. WHEN用户点击任何按钮，THE HADS系统 SHALL 在1秒内提供视觉反馈
2. WHILE执行耗时操作（如连接测试），THE HADS系统 SHALL 显示进度指示器
3. WHEN操作完成，THE HADS系统 SHALL 通过颜色或图标明确标识成功或失败状态
4. THE HADS系统 SHALL 在界面关键位置提供tooltip提示帮助用户理解功能
5. WHEN发生错误，THE HADS系统 SHALL 使用自然语言描述错误而非技术术语

### 需求8：安全性保障

**用户故事：** 作为系统用户，我希望我的虚拟机登录凭证能够得到安全保护，以防止敏感信息泄露。

#### 验收标准

1. THE HADS系统 SHALL 在内存中加密存储用户输入的密码
2. THE HADS系统 SHALL 在日志文件中自动脱敏密码信息（替换为"***"）
3. THE HADS系统 SHALL 使用AES-256算法加密配置文件中的密码字段
4. THE HADS系统 SHALL 确保SSH连接使用加密通道传输数据
5. WHEN应用程序退出，THE HADS系统 SHALL 清除内存中的敏感信息
